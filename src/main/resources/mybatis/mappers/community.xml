<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="community">
	
	<!-- 쿼리문 작성 -->
	
	<!-- select 예제 -->
	<select id="selectList" resultType="CommunityVo">
		<![CDATA[
			
   				SELECT   c.cpostNo, 
					 c.cpostType, 
					 u.userNo, 
                     regDate,
					 c.cpostTitle,
					 c.cpostContent,
					 c.liked
			FROM  communitypost c join users u
			ON c.userNo = u.userNo
			where c.cpostType = 1
			order by c.cpostNo desc
			
		]]>
	</select>
	
	
	<select id="selectLiked" resultType="CommunityVo">
		<![CDATA[
			select cpostTitle,regDate,liked
            from (
                select * 
                from communitypost 
                where cposttype = 1
                order by liked desc
            )
            where  rownum <= 10
            	
		]]>
	</select>

	<!-- no로 글조회 -->
	<select id="selectNotice" parameterType="int" resultType="CommunityVo">
		<![CDATA[
			select cpostNo, 
					   cpostTitle, 
					   cpostContent,
					   liked, 
					   TO_CHAR(regDate, 'yyyy/mm/dd') as regDate,  
					   userNo
			     from communitypost
			     where cpostNo = #{cpostNo}     
			     
		]]>
	</select>
	
	<select id="selectLocation" parameterType="String" resultType="LocationVo">
		<![CDATA[
			SELECT locationNo
			FROM location
			where address = #{address}
		]]>
	</select>
	
	<insert id="insertPost" parameterType="CommunityVo">
		<selectKey keyProperty="cpostNo" resultType="int" order="BEFORE">
			select seq_cpost_no.nextval from dual
		</selectKey>
		<![CDATA[
			INSERT INTO COMMUNITYPOST
				(cpostNo,
				 cpostTitle,
				 cpostContent,
				 userNo,
				 cpostType,
				 regDate,
				 liked)
			VALUES
				(#{cpostNo},
				 #{cpostTitle},
				 #{cpostContent},
				 #{userNo},
				 #{cpostType},
				 SYSDATE,
				 0
				)
		]]>
	</insert>
	
	<insert id="insertLocation" parameterType="CommunityVo">
		<selectKey keyProperty="locationNo" resultType="int" order="BEFORE">
			select seq_location_no.nextval from dual
		</selectKey>
		<![CDATA[
			INSERT INTO LOCATION
				(businessName,
				 address,
				 longitude,
				 latitude,
				 locationNo)
			VALUES
				(#{businessName},
				 #{address},
				 #{longitude},
				 #{latitude},
				 #{locationNo})
		]]>
	</insert>
	
	<insert id="insertLocationPost" parameterType="map">
		<![CDATA[
			INSERT INTO LOCATIONPOST
				(locationPostNo,
				 locationNo,
				 cpostNo)
			VALUES
				(seq_locationpost_no.nextval,
				#{locationNo},
				#{cpostNo})
		]]>
	</insert>
	
	<insert id="insertFile" parameterType="fileUpLoadVo">
		<selectKey keyProperty="fileNo" resultType="int" order="BEFORE">
			select seq_datafile_no.nextval from dual
		</selectKey>
		<![CDATA[
			INSERT INTO DATAFIlE
				(fileNo,
				 fileName,
				 saveName,
				 fileSize,
				 regDate,
				 filepath)
			VALUES
				(#{fileNo},
				 #{fileName},
				 #{saveName},
				 #{fileSize},
				 SYSDATE,
				 #{filepath})
		]]>
	</insert>
	
	<insert id="insertCommunityFile" parameterType="map">
		<![CDATA[
			INSERT INTO COMMUNITYFILE
				(cfileNo,
				 cpostNo,
				 fileNo)
			VALUES
				(seq_cfile_no.nextval,
				 #{cpostNo},
				 #{cfileNo})
		]]>
	</insert>

</mapper>
