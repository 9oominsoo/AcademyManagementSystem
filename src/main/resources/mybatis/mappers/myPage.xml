<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="myPage">


	<!-- 왼쪽 폴더 리스트들 틀림 -->
	<select id="secectCourse" resultType="myPageVo"
		parameterType="myPageVo">
		<![CDATA[
			select 	cr.courseNo as CourseNo, 
					c.courseName as CourseName
			from courseRegist cr join course c 
			on cr.courseNo=c.courseNo 
			where userNo= #{userNo}
		]]>
	</select>
	
	<select id="selectCoursePath" resultType="PostVo"
		parameterType="PostVo">
		<![CDATA[
			select * from course where courseno=#{courseNo}
		]]>
	</select>


	<!-- 1 이면 공지사항 2이면 QNA -->
	<select id="selectNotice" resultType="PostVo" parameterType="PostVo">
		<![CDATA[
        select 	        rownum as rnum,
                        a.username as username,
       					postno,
      					posttype,
       					posttitle,
       					postcontent,
       					userno,
       					courseno,
       					regdate,
       					scheduleno,
       					hit,
       					category
		from ( SELECT 				
   		     						p.postNo,
				        			p.postType,
				        			u.userNo,
				        			p.courseNo,
				        			TO_CHAR(p.regDate, 'yyyy/mm/dd') as regDate,
				        			p.scheduleNo,
				        			p.postTitle,
				        			p.postContent,
				        			p.hit,
				        			p.category,
				        			u.userName
							FROM users u join post p 
							ON p.userNo = u.userNo
							where p.postType = 1 and p.userno = #{userNo}
							order by postNo desc ) a 
        where rownum <=#{rnum}

		]]>
	</select>
	
	<!-- 1 이면 공지사항 2이면 QNA -->
	<select id="selectQna" resultType="PostVo" parameterType="PostVo">
		<![CDATA[
				

SELECT    rownum as rnum, 
		                a.postNo postno,
		                a.postType postType,
		                a.userNo userNo,
		                a.courseNo courseNo,
		                a.regDate regDate,
		                a.scheduleNo scheduleNo,
		                a.postTitle postTitle,
		                a.postContent postContent,
		                a.hit hit,
		                a.category category,
		                a.userName userName,
		                a.subjectNo subjectNo,
		                a.subjectTitle subjectTitle,
		                a.replyCount replyCount
		           
        FROM(
					SELECT    rownum as rnum, 
					                pu.postNo,
					                pu.postType,
					                pu.userNo,
					                pu.courseNo courseNo,
					                pu.regDate,
					                pu.scheduleNo scheduleNo,
					                pu.postTitle,
					                pu.postContent,
					                pu.hit,
					                pu.category,
					                pu.userName,
					                pu.subjectNo,
					                s.subjectTitle,
					                (select count(*) from reply r 
					        	where r.postNo = pu.postNo) as replyCount
		        FROM(
		                SELECT  postNo,
		                        postType,
		                        p.userNo userNo,
		                        courseNo,
		                        TO_CHAR(regDate, 'yyyy/mm/dd') as regDate,
		                        scheduleNo,
		                        postTitle,
		                        postContent,
		                        hit,
		                        category,
		                        userName,
		                        subjectNo
		                FROM users u join post p
		                ON p.userNo = u.userNo
		                where p.postType = 2 and p.userno= #{userNo})pu
		                left join subject s 
		                on pu.subjectno = s.subjectno 
		                order by pu.postNo desc) a
		                where rownum <= #{rnum}
		]]>
	</select>
	
	
	<select id="selectTimelineList" parameterType="TimelineVo" resultType="TimelineVo">
	<![CDATA[
	select  rownum 
        timelineno,
        timelinecontent, 
        regdate, 
        userno 
	from(
    	select  tl.timelineno,
       	 	    tl.timelinecontent, 
         	  	tl.regdate, 
            	tlu.userno 
   	 	from timeline tl join timelineuser tlu 
    	on tl.timelineno = tlu.timelineno
    	where tlu.userno=#{userNo}
    	order by timelineno desc) a
	where rownum <= #{rnum}


	]]>
	</select>
	
	
	<select id="selectTimelineAllList" parameterType="TimelineVo" resultType="TimelineVo">
	<![CDATA[
	
    	select  tl.timelineno as timeLineNo,
       	 	    tl.timelinecontent as timeLineContent, 
         	  	tl.regdate as regDate, 
            	tlu.userno as userNo 
   	 	from timeline tl join timelineuser tlu 
    	on tl.timelineno = tlu.timelineno
    	where tlu.userno=#{userNo}
    	order by timelineno desc


	]]>
	</select>
	
	


</mapper>

