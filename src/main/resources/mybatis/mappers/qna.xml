<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="qna">
	<select id="selectAll" parameterType="int" resultType="PostVo">
		<![CDATA[
		SELECT 	rownum,
        postNo,
        postType,
        userNo,
        fileNo,
        courseNo,
        regDate,
        communityNo,
        scheduleNo,
        postTitle,
        postContent,
        hit,
        category,
        userName,
        subjectNo,
        subjectTitle 
FROM (SELECT    postNo,
                postType,
                userNo,
                fileNo,
                pu.courseNo courseNo,
                regDate,
                communityNo,
                pu.scheduleNo scheduleNo,
                postTitle,
                postContent,
                hit,
                category,
                userName,
                pu.subjectNo,
                subjectTitle
        FROM(
                SELECT  postNo,
                        postType,
                        p.userNo userNo,
                        fileNo,
                        courseNo,
                        TO_CHAR(regDate, 'yyyy/mm/dd') as regDate,
                       communityNo,
                        scheduleNo,
                        postTitle,
                        postContent,
                        hit,
                        category,
                        userName,
                        subjectNo
                FROM post p join users u
                ON p.userNo = u.userNo) pu
                left join subject s on pu.subjectno = s.subjectno 
                where postType = 2
                order by postNo desc)
                            
				order by rownum desc
		]]>
	</select>


	<!-- no로 글조회 -->
	<select id="selectNotice" parameterType="int" resultType="PostVo">
		<![CDATA[
		SELECT  postNo, 
			    postTitle, 
			    postContent,
			    hit, 
			    regDate, 
			    userNo, 
                subjectTitle
        FROM(
				select postNo, 
					   postTitle, 
					   postContent,
					   hit, 
					   TO_CHAR(regDate, 'yyyy/mm/dd') as regDate,  
					   userNo,
					   p.subjectNo subjectNo,
					   subjectTitle
			     from post p join subject s
			     on p.subjectno = s.subjectno) 
			     where postNo = #{postNo}     
			     
		]]>
	</select>

	<!-- 조회수 증가 -->
	<update id="updateHit" parameterType="int">
		<![CDATA[
			update post 
			set hit = hit+1
			where postNo = #{postNo}
		]]>
	</update>



	<!-- 글저장 -->
	<insert id="insert" parameterType="PostVo">
		<![CDATA[
			insert into post(postNo,postType,userNo,courseNo,regDate,postTitle,postContent,hit,subjectNo)
			values (
					seq_post_no.nextval,
					2,
					#{userNo},	
					1,	
					sysdate,		 
					#{postTitle}, 					
					#{postContent}, 
					#{hit},
					#{subjectNo}
			) 
		]]>
	</insert>


	<!-- 과목리스트 -->
	<select id="selectSubjectAll" parameterType="int" resultType="SubjectVo">
		<![CDATA[
							
				
				SELECT   subjectNo,
				        subjectTitle
				        FROM subject 
		]]>
	</select>



	<!-- 글삭제 -->
	<delete id="delete" parameterType="PostVo">
		<![CDATA[
			delete from post 
			where userNo = #{userNo}
			and postNo = #{postNo}
		]]>
	</delete>
	
	
	<!-- 글수정 -->
	<update id="update" parameterType="PostVo">
		<![CDATA[
			update post 
		   	set postTitle=#{postTitle},
		       	postContent=#{postContent}
		 	where postNo=#{postNo}
		  	and userNo = #{userNo}
		]]>
	</update>
	

</mapper>
